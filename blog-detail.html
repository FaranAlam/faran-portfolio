<!DOCTYPE html>
<html lang="en">

<head>
    <title>Blog Article - Faran</title>
    <link rel="icon" type="image/jpg" href="images/logo1.jpg">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Read detailed blog article">

    <!-- CSS -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/animate.css">

    <style>
        /* Blog Detail Styles */
        
        .blog-detail-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 60px 20px;
        }
        
        .blog-detail-header {
            margin-bottom: 40px;
        }
        
        .blog-detail-title {
            font-size: 42px;
            font-weight: 700;
            line-height: 1.3;
            margin-bottom: 20px;
            color: #333;
        }
        
        .blog-detail-meta {
            display: flex;
            align-items: center;
            gap: 30px;
            flex-wrap: wrap;
            padding-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
            margin-bottom: 30px;
            font-size: 14px;
            color: #666;
        }
        
        .blog-detail-meta span {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .blog-detail-category {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .blog-detail-image {
            width: 100%;
            height: 500px;
            object-fit: cover;
            border-radius: 12px;
            margin-bottom: 40px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
        }
        
        .blog-detail-content {
            font-size: 16px;
            line-height: 1.8;
            color: #555;
            margin-bottom: 40px;
        }
        
        .blog-detail-content h2 {
            font-size: 28px;
            font-weight: 700;
            color: #333;
            margin: 30px 0 15px 0;
        }
        
        .blog-detail-content h3 {
            font-size: 22px;
            font-weight: 600;
            color: #444;
            margin: 25px 0 12px 0;
        }
        
        .blog-detail-content p {
            margin-bottom: 15px;
        }
        
        .blog-detail-content ul,
        .blog-detail-content ol {
            margin: 20px 0 20px 30px;
        }
        
        .blog-detail-content li {
            margin-bottom: 10px;
        }
        
        .blog-detail-content code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            color: #d63384;
        }
        
        .blog-detail-content pre {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 20px 0;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .blog-detail-content blockquote {
            border-left: 4px solid #667eea;
            padding: 20px;
            margin: 20px 0;
            background: #f8f9fa;
            font-style: italic;
            color: #666;
        }
        
        .blog-detail-tags {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 40px;
            padding-bottom: 40px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .blog-tag {
            background: #f0f0f0;
            color: #667eea;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .blog-tag:hover {
            background: #667eea;
            color: white;
        }
        
        .blog-detail-author {
            display: flex;
            gap: 20px;
            padding: 25px;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            border-radius: 12px;
            margin-bottom: 40px;
            align-items: center;
        }
        
        .blog-author-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            flex-shrink: 0;
        }
        
        .blog-author-info h4 {
            font-size: 16px;
            font-weight: 700;
            margin: 0 0 5px 0;
            color: #333;
        }
        
        .blog-author-info p {
            font-size: 14px;
            color: #666;
            margin: 0;
        }
        
        .blog-share {
            display: flex;
            gap: 12px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .share-btn {
            padding: 10px 16px;
            border: 2px solid #e9ecef;
            background: white;
            color: #667eea;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 12px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }
        
        .share-btn:hover {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        .related-blogs {
            margin-top: 60px;
            padding-top: 40px;
            border-top: 2px solid #f0f0f0;
        }
        
        .related-blogs h3 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 30px;
            color: #333;
        }
        
        .related-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
        }
        
        .related-card {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
        }
        
        .related-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }
        
        .related-card-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            background: #f0f0f0;
        }
        
        .related-card-content {
            padding: 20px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .related-card-title {
            font-size: 16px;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
            line-height: 1.4;
        }
        
        .related-card-title a {
            color: #333;
            text-decoration: none;
            transition: color 0.3s ease;
        }
        
        .related-card-title a:hover {
            color: #667eea;
        }
        
        .related-card-excerpt {
            font-size: 13px;
            color: #666;
            line-height: 1.5;
            margin-bottom: 12px;
            flex: 1;
        }
        
        .related-card-meta {
            font-size: 11px;
            color: #999;
            display: flex;
            justify-content: space-between;
        }
        
        .loading-spinner {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 500px;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
        
        .error-container {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }
        
        .error-container i {
            font-size: 64px;
            color: #ddd;
            margin-bottom: 20px;
        }
        
        .error-container h2 {
            font-size: 28px;
            color: #333;
            margin-bottom: 10px;
        }
        
        .error-container p {
            font-size: 16px;
            margin-bottom: 20px;
        }
        
        .error-container a {
            display: inline-block;
            padding: 12px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-decoration: none;
            border-radius: 6px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .error-container a:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }
        
        .breadcrumb {
            margin-bottom: 30px;
            font-size: 14px;
            color: #999;
        }
        
        .breadcrumb a {
            color: #667eea;
            text-decoration: none;
            transition: color 0.3s ease;
        }
        
        .breadcrumb a:hover {
            color: #764ba2;
        }
        
        @media (max-width: 768px) {
            .blog-detail-container {
                padding: 30px 15px;
            }
            .blog-detail-title {
                font-size: 28px;
            }
            .blog-detail-image {
                height: 300px;
            }
            .blog-detail-meta {
                gap: 15px;
                font-size: 12px;
            }
            .blog-detail-author {
                flex-direction: column;
                text-align: center;
            }
            .blog-share {
                justify-content: center;
            }
            .related-grid {
                grid-template-columns: 1fr;
            }
        }
        /* Comments Section Styles */
        
        .comments-section {
            margin-top: 60px;
            padding-top: 40px;
            border-top: 2px solid #f0f0f0;
        }
        
        .comments-title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 30px;
            color: #333;
        }
        
        .comment-form-container {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 40px;
        }
        
        .comment-form .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .comment-form .form-group {
            position: relative;
        }
        
        .comment-form input,
        .comment-form textarea {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 15px;
            font-family: inherit;
            transition: all 0.3s ease;
            background: white;
        }
        
        .comment-form input:focus,
        .comment-form textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .comment-form textarea {
            resize: vertical;
            min-height: 120px;
        }
        
        .char-counter {
            text-align: right;
            font-size: 12px;
            color: #999;
            margin-top: 5px;
        }
        
        .submit-comment-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 14px 32px;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }
        
        .submit-comment-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }
        
        .submit-comment-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .comments-list {
            margin-top: 40px;
        }
        
        .comment-item {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }
        
        .comment-item:hover {
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }
        
        .comment-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 12px;
        }
        
        .comment-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 18px;
            flex-shrink: 0;
        }
        
        .comment-meta {
            flex: 1;
        }
        
        .comment-author {
            font-weight: 700;
            color: #333;
            font-size: 16px;
            margin: 0;
        }
        
        .comment-date {
            font-size: 13px;
            color: #999;
        }
        
        .comment-text {
            color: #555;
            line-height: 1.7;
            font-size: 15px;
            margin: 0;
            word-wrap: break-word;
        }
        
        .no-comments {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }
        
        .no-comments i {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.2;
        }
        
        .no-comments p {
            font-size: 16px;
            margin: 0;
        }
        
        .comment-success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
            align-items: center;
            gap: 10px;
        }
        
        .comment-error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
            align-items: center;
            gap: 10px;
        }
        
        @media (max-width: 768px) {
            .comment-form .form-row {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            .comment-form-container {
                padding: 20px;
            }
            .comments-title {
                font-size: 22px;
            }
            .comment-item {
                padding: 18px;
            }
            .comment-avatar {
                width: 40px;
                height: 40px;
                font-size: 16px;
            }
        }
    </style>
</head>

<body>
    <!-- Blog Detail Section -->
    <section style="background: #f8f9fa;">
        <div class="blog-detail-container">
            <!-- Breadcrumb -->
            <div class="breadcrumb">
                <a href="index.html"><i class="fas fa-home"></i> Home</a> /
                <a href="blog.html"><i class="fas fa-blog"></i> Blog</a> /
                <span id="breadcrumbTitle">Loading...</span>
            </div>

            <!-- Loading State -->
            <div id="loadingState" class="loading-spinner">
                <div class="spinner"></div>
            </div>

            <!-- Error State -->
            <div id="errorState" class="error-container" style="display: none;">
                <i class="fas fa-exclamation-circle"></i>
                <h2>Blog Not Found</h2>
                <p>Sorry, the blog article you're looking for doesn't exist.</p>
                <a href="blog.html">‚Üê Back to Blog</a>
            </div>

            <!-- Content State -->
            <div id="contentState" style="display: none;">
                <!-- Blog Header -->
                <div class="blog-detail-header">
                    <div style="display: flex; gap: 15px; align-items: center; margin-bottom: 20px;">
                        <span class="blog-detail-category" id="blogCategory">Technology</span>
                        <span style="color: #999; font-size: 14px;" id="blogDate">Published date</span>
                    </div>
                    <h1 class="blog-detail-title" id="blogTitle">Blog Title</h1>
                    <div class="blog-detail-meta">
                        <span><i class="fas fa-eye"></i> <span id="blogViews">0</span> views</span>
                        <span><i class="fas fa-clock"></i> <span id="blogReadTime">5</span> min read</span>
                        <span><i class="fas fa-user"></i> Faran Alam</span>
                    </div>
                </div>

                <!-- Featured Image -->
                <img id="blogImage" src="" alt="Blog featured image" class="blog-detail-image" onerror="this.style.display='none'">

                <!-- Blog Content -->
                <div class="blog-detail-content" id="blogContent">
                    Loading content...
                </div>

                <!-- Tags -->
                <div id="tagsSection" class="blog-detail-tags"></div>

                <!-- Author Bio -->
                <div class="blog-detail-author">
                    <div class="blog-author-avatar"><i class="fas fa-user"></i></div>
                    <div class="blog-author-info">
                        <h4>Faran Alam</h4>
                        <p>Full-stack developer passionate about web technologies, clean code, and innovative solutions.</p>
                        <div class="blog-share">
                            <a class="share-btn" href="#" onclick="shareOnTwitter(event)">
                                <i class="fab fa-twitter"></i> Twitter
                            </a>
                            <a class="share-btn" href="#" onclick="shareOnLinkedIn(event)">
                                <i class="fab fa-linkedin"></i> LinkedIn
                            </a>
                            <a class="share-btn" href="#" onclick="copyLink(event)">
                                <i class="fas fa-link"></i> Copy Link
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Related Blogs -->
                <div class="related-blogs" id="relatedSection" style="display: none;">
                    <h3>üìñ Related Articles</h3>
                    <div class="related-grid" id="relatedGrid"></div>
                </div>

                <!-- Comments Section -->
                <div class="comments-section" id="commentsSection">
                    <h3 class="comments-title">üí¨ Comments (<span id="commentCount">0</span>)</h3>

                    <!-- Comment Form -->
                    <div class="comment-form-container">
                        <h4 style="font-size: 18px; margin-bottom: 20px; color: #333;">Leave a Comment</h4>
                        <form id="commentForm" class="comment-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <input type="text" id="commentName" placeholder="Your Name *" required maxlength="100">
                                </div>
                                <div class="form-group">
                                    <input type="email" id="commentEmail" placeholder="Your Email *" required maxlength="200">
                                </div>
                            </div>
                            <div class="form-group">
                                <textarea id="commentText" placeholder="Your Comment *" rows="5" required maxlength="1000"></textarea>
                                <div class="char-counter"><span id="charCount">0</span>/1000</div>
                            </div>
                            <button type="submit" class="submit-comment-btn" id="submitCommentBtn">
                                <i class="fas fa-paper-plane"></i> Post Comment
                            </button>
                        </form>
                    </div>

                    <!-- Comments List -->
                    <div class="comments-list" id="commentsList">
                        <div style="text-align: center; padding: 40px; color: #999;">
                            <i class="fas fa-comments" style="font-size: 48px; margin-bottom: 15px; opacity: 0.3;"></i>
                            <p>Loading comments...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="ftco-footer-section" style="background: #222; color: white; padding: 40px 20px; text-align: center; margin-top: 60px;">
        <div class="blog-detail-container">
            <p style="margin: 0;">&copy; 2026 Faran Alam. All rights reserved.</p>
            <p style="margin: 10px 0 0 0; font-size: 12px; opacity: 0.7;">Built with passion for web development</p>
        </div>
    </footer>

    <script>
        const API_BASE_URL = 'http://localhost:5000';
        let currentBlog = null;

        // Load blog on page load
        window.addEventListener('DOMContentLoaded', () => {
            loadBlogDetail();
            setupCommentForm();
        });

        // Load blog detail
        async function loadBlogDetail() {
            try {
                // Get slug from localStorage or URL parameter
                let slug = localStorage.getItem('selectedBlogSlug');
                localStorage.removeItem('selectedBlogSlug');

                if (!slug) {
                    const params = new URLSearchParams(window.location.search);
                    slug = params.get('slug');
                }

                if (!slug) {
                    showError();
                    return;
                }

                // Fetch blog
                const response = await fetch(`${API_BASE_URL}/blogs/${slug}`);
                if (!response.ok) {
                    showError();
                    return;
                }

                currentBlog = await response.json();

                // Increment view count
                try {
                    await fetch(`${API_BASE_URL}/blogs/${slug}/view`, {
                        method: 'POST'
                    });
                } catch (e) {
                    console.log('Could not update view count');
                }

                // Display content
                displayBlog();
                loadRelatedBlogs();
                loadComments();

            } catch (error) {
                console.error('Error loading blog:', error);
                showError();
            }
        }

        // Display blog content
        function displayBlog() {
            if (!currentBlog) return;

            // Update page title
            document.title = `${currentBlog.title} - Faran Blog`;
            document.querySelector('meta[name="description"]').setAttribute('content', currentBlog.seoDescription || currentBlog.excerpt);

            // Hide loading, show content
            document.getElementById('loadingState').style.display = 'none';
            document.getElementById('contentState').style.display = 'block';

            // Update header
            document.getElementById('breadcrumbTitle').textContent = currentBlog.title;
            document.getElementById('blogTitle').textContent = currentBlog.title;
            document.getElementById('blogCategory').textContent = currentBlog.category || 'Technology';
            document.getElementById('blogDate').textContent = `Published ${formatDate(currentBlog.createdAt)}`;
            document.getElementById('blogViews').textContent = currentBlog.views || 0;
            document.getElementById('blogReadTime').textContent = currentBlog.readTime || 5;

            // Update image
            if (currentBlog.image) {
                document.getElementById('blogImage').src = currentBlog.image;
            }

            // Update content (sanitized)
            const contentDiv = document.getElementById('blogContent');
            contentDiv.innerHTML = sanitizeHtml(currentBlog.content);

            // Update tags
            if (currentBlog.tags && currentBlog.tags.length > 0) {
                document.getElementById('tagsSection').innerHTML = currentBlog.tags
                    .map(tag => `
                        <span class="blog-tag" onclick="goToBlogWithTag('${escapeAttribute(tag)}')">#${escapeHtml(tag)}</span>
                    `)
                    .join('');
            }
        }

        // Load related blogs
        async function loadRelatedBlogs() {
            if (!currentBlog) return;

            try {
                const response = await fetch(`${API_BASE_URL}/blogs?limit=100`);
                if (!response.ok) return;

                const data = await response.json();

                // Get related blogs by category or tags
                let related = data.blogs.filter(blog =>
                    blog.slug !== currentBlog.slug &&
                    (blog.category === currentBlog.category ||
                        (blog.tags && currentBlog.tags &&
                            blog.tags.some(tag => currentBlog.tags.includes(tag))))
                ).slice(0, 3);

                // If not enough related blogs, add recent ones
                if (related.length < 3) {
                    const recent = data.blogs
                        .filter(blog => blog.slug !== currentBlog.slug && !related.find(r => r.slug === blog.slug))
                        .slice(0, 3 - related.length);
                    related = [...related, ...recent];
                }

                if (related.length === 0) return;

                document.getElementById('relatedSection').style.display = 'block';
                document.getElementById('relatedGrid').innerHTML = related.map(blog => `
                    <div class="related-card">
                        <img src="${blog.image}" alt="${escapeHtml(blog.title)}" class="related-card-image"
                             onerror="this.style.display='none'">
                        <div class="related-card-content">
                            <h4 class="related-card-title">
                                <a href="#" onclick="viewBlog('${escapeAttribute(blog.slug)}', event)">${escapeHtml(blog.title)}</a>
                            </h4>
                            <p class="related-card-excerpt">${escapeHtml(blog.excerpt || blog.title)}</p>
                            <div class="related-card-meta">
                                <span>${formatDate(blog.createdAt)}</span>
                                <span>${blog.readTime || 5} min</span>
                            </div>
                        </div>
                    </div>
                `).join('');

            } catch (error) {
                console.error('Error loading related blogs:', error);
            }
        }

        // Show error state
        function showError() {
            document.getElementById('loadingState').style.display = 'none';
            document.getElementById('contentState').style.display = 'none';
            document.getElementById('errorState').style.display = 'block';
        }

        // View blog
        function viewBlog(slug, event) {
            event.preventDefault();
            localStorage.setItem('selectedBlogSlug', slug);
            location.reload();
        }

        // Go to blog with tag filter
        function goToBlogWithTag(tag) {
            localStorage.setItem('selectedBlogTag', tag);
            window.location.href = 'blog.html';
        }

        // Share functions
        function shareOnTwitter(e) {
            e.preventDefault();
            const text = `Check out this article: ${currentBlog.title}`;
            const url = window.location.href;
            window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`, '_blank');
        }

        function shareOnLinkedIn(e) {
            e.preventDefault();
            const url = window.location.href;
            window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(url)}`, '_blank');
        }

        function copyLink(e) {
            e.preventDefault();
            navigator.clipboard.writeText(window.location.href).then(() => {
                alert('Link copied to clipboard!');
            });
        }

        // Utility functions
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function escapeAttribute(text) {
            return text.replace(/'/g, '&#39;').replace(/"/g, '&quot;');
        }

        function sanitizeHtml(html) {
            // Simple sanitization - allow basic formatting only
            const allowedTags = ['p', 'h2', 'h3', 'h4', 'h5', 'h6', 'ul', 'ol', 'li', 'strong', 'em', 'code', 'pre', 'blockquote', 'a', 'img', 'br'];
            const temp = document.createElement('div');
            temp.innerHTML = html;

            function sanitizeNode(node) {
                if (node.nodeType === Node.TEXT_NODE) {
                    return node.cloneNode(true);
                }
                if (node.nodeType === Node.ELEMENT_NODE) {
                    if (allowedTags.includes(node.tagName.toLowerCase())) {
                        const cleanNode = node.cloneNode(false);
                        for (let child of node.childNodes) {
                            const sanitized = sanitizeNode(child);
                            if (sanitized) cleanNode.appendChild(sanitized);
                        }
                        // Remove dangerous attributes
                        for (let attr of['onclick', 'onerror', 'onload', 'javascript']) {
                            cleanNode.removeAttribute(attr);
                        }
                        // Allow only safe href
                        if (cleanNode.tagName === 'A') {
                            const href = cleanNode.getAttribute('href') || '';
                            if (!href.startsWith('javascript:')) {
                                cleanNode.target = '_blank';
                                cleanNode.rel = 'noopener noreferrer';
                            }
                        }
                        return cleanNode;
                    }
                }
                return null;
            }

            const result = document.createElement('div');
            for (let child of temp.childNodes) {
                const sanitized = sanitizeNode(child);
                if (sanitized) result.appendChild(sanitized);
            }
            return result.innerHTML;
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }

        // ===========================
        // COMMENT SYSTEM FUNCTIONS
        // ===========================

        // Setup comment form
        function setupCommentForm() {
            const form = document.getElementById('commentForm');
            const textarea = document.getElementById('commentText');
            const charCount = document.getElementById('charCount');

            // Character counter
            textarea.addEventListener('input', () => {
                const count = textarea.value.length;
                charCount.textContent = count;

                if (count > 950) {
                    charCount.style.color = '#dc3545';
                } else if (count > 800) {
                    charCount.style.color = '#ffc107';
                } else {
                    charCount.style.color = '#999';
                }
            });

            // Form submission
            form.addEventListener('submit', handleCommentSubmit);
        }

        // Handle comment submission
        async function handleCommentSubmit(e) {
            e.preventDefault();

            if (!currentBlog) {
                alert('Blog not loaded. Please refresh the page.');
                return;
            }

            const name = document.getElementById('commentName').value.trim();
            const email = document.getElementById('commentEmail').value.trim();
            const comment = document.getElementById('commentText').value.trim();
            const submitBtn = document.getElementById('submitCommentBtn');

            // Validation
            if (!name || !email || !comment) {
                showCommentError('All fields are required.');
                return;
            }

            if (name.length > 100) {
                showCommentError('Name is too long (max 100 characters).');
                return;
            }

            if (email.length > 200) {
                showCommentError('Email is too long (max 200 characters).');
                return;
            }

            if (comment.length > 1000) {
                showCommentError('Comment is too long (max 1000 characters).');
                return;
            }

            // Email validation
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                showCommentError('Please enter a valid email address.');
                return;
            }

            // Disable button
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Posting...';

            try {
                const response = await fetch(`${API_BASE_URL}/blogs/${currentBlog.slug}/comments`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        name,
                        email,
                        comment
                    })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.message || 'Failed to post comment');
                }

                // Success
                showCommentSuccess('Comment posted successfully! üéâ');

                // Clear form
                document.getElementById('commentForm').reset();
                document.getElementById('charCount').textContent = '0';

                // Reload comments
                loadComments();

            } catch (error) {
                console.error('Error posting comment:', error);
                showCommentError(error.message || 'Failed to post comment. Please try again.');
            } finally {
                // Re-enable button
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Post Comment';
            }
        }

        // Load comments for current blog
        async function loadComments() {
            if (!currentBlog) return;

            try {
                const response = await fetch(`${API_BASE_URL}/blogs/${currentBlog.slug}/comments`);

                if (!response.ok) {
                    throw new Error('Failed to load comments');
                }

                const data = await response.json();
                const comments = data.comments || [];

                // Update count
                document.getElementById('commentCount').textContent = comments.length;

                // Display comments
                displayComments(comments);

            } catch (error) {
                console.error('Error loading comments:', error);
                document.getElementById('commentsList').innerHTML = `
                    <div class="no-comments">
                        <i class="fas fa-exclamation-circle"></i>
                        <p>Unable to load comments.</p>
                    </div>
                `;
            }
        }

        // Display comments
        function displayComments(comments) {
            const container = document.getElementById('commentsList');

            if (comments.length === 0) {
                container.innerHTML = `
                    <div class="no-comments">
                        <i class="fas fa-comments"></i>
                        <p>No comments yet. Be the first to share your thoughts!</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = comments.map(comment => {
                const initial = comment.name.charAt(0).toUpperCase();
                const timeAgo = getTimeAgo(comment.createdAt);

                return `
                    <div class="comment-item">
                        <div class="comment-header">
                            <div class="comment-avatar">${initial}</div>
                            <div class="comment-meta">
                                <p class="comment-author">${escapeHtml(comment.name)}</p>
                                <span class="comment-date">
                                    <i class="fas fa-clock"></i> ${timeAgo}
                                </span>
                            </div>
                        </div>
                        <p class="comment-text">${escapeHtml(comment.comment)}</p>
                    </div>
                `;
            }).join('');
        }

        // Show success message
        function showCommentSuccess(message) {
            // Remove any existing messages
            const existingSuccess = document.querySelector('.comment-success');
            const existingError = document.querySelector('.comment-error');
            if (existingSuccess) existingSuccess.remove();
            if (existingError) existingError.remove();

            // Create and show success message
            const successDiv = document.createElement('div');
            successDiv.className = 'comment-success';
            successDiv.style.display = 'flex';
            successDiv.innerHTML = `<i class="fas fa-check-circle"></i> ${message}`;

            const form = document.getElementById('commentForm');
            form.parentNode.insertBefore(successDiv, form);

            // Auto-hide after 5 seconds
            setTimeout(() => {
                successDiv.style.display = 'none';
            }, 5000);
        }

        // Show error message
        function showCommentError(message) {
            // Remove any existing messages
            const existingSuccess = document.querySelector('.comment-success');
            const existingError = document.querySelector('.comment-error');
            if (existingSuccess) existingSuccess.remove();
            if (existingError) existingError.remove();

            // Create and show error message
            const errorDiv = document.createElement('div');
            errorDiv.className = 'comment-error';
            errorDiv.style.display = 'flex';
            errorDiv.innerHTML = `<i class="fas fa-exclamation-circle"></i> ${message}`;

            const form = document.getElementById('commentForm');
            form.parentNode.insertBefore(errorDiv, form);

            // Auto-hide after 5 seconds
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 5000);
        }

        // Get time ago string
        function getTimeAgo(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const seconds = Math.floor((now - date) / 1000);

            if (seconds < 60) return 'Just now';
            if (seconds < 3600) return `${Math.floor(seconds / 60)} minutes ago`;
            if (seconds < 86400) return `${Math.floor(seconds / 3600)} hours ago`;
            if (seconds < 604800) return `${Math.floor(seconds / 86400)} days ago`;

            return formatDate(dateString);
        }
    </script>
</body>

</html>